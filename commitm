#!/usr/bin/env perl

use v5.10;
use utf8;
use strict;
use FindBin qw($Bin $Script);
use YAML::XS qw(LoadFile);
use Getopt::Long;
use Try::Catch;

sub main {
    my $lang = '_';

    my $load_messages = sub {
        my ($lang) = @_;

        my $msgs;
        my $msg_file = "$Bin/messages/$lang.yml";

        try {
            $msgs = LoadFile($msg_file);
        }
        catch {
            die "Failed loading $msg_file -> $_";
        };

        return $msgs;
    };

    try {
        GetOptions('language=s', \$lang);
    }
    catch {
        die 'Failed getting command line arguments.';
    };

    my $msgs = $load_messages->($lang);

    unless (ref $msgs eq 'ARRAY') {
        die "No message list for ‘$lang’ found";
    }

    say $msgs->[rand @$msgs];
}

binmode(STDOUT, ':encoding(UTF-8)');
main();
